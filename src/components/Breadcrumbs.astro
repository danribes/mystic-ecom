---
/**
 * Breadcrumbs Component (T232)
 *
 * Displays visual breadcrumb navigation and includes Schema.org BreadcrumbList structured data.
 *
 * @see https://schema.org/BreadcrumbList
 * @see https://developers.google.com/search/docs/appearance/structured-data/breadcrumb
 */

import { generateBreadcrumbsWithSchema, type BreadcrumbOptions } from '@/lib/breadcrumbs';
import { generateBreadcrumbListSchema } from '@/lib/structuredData';

// Component props
interface Props {
  /**
   * Custom labels for specific path segments
   * @example { 'courses': 'All Courses', 'meditation-basics': 'Meditation for Beginners' }
   */
  customLabels?: Record<string, string>;

  /**
   * Home link label
   * @default 'Home'
   */
  homeLabel?: string;

  /**
   * Maximum number of breadcrumb items to show
   * @default undefined (show all)
   */
  maxItems?: number;

  /**
   * Hide visual breadcrumbs (only include schema)
   * @default false
   */
  hideVisual?: boolean;

  /**
   * Additional CSS classes for the breadcrumb container
   */
  className?: string;

  /**
   * Accessibility label for the breadcrumb navigation
   * @default 'Breadcrumb'
   */
  ariaLabel?: string;
}

const {
  customLabels,
  homeLabel = 'Home',
  maxItems,
  hideVisual = false,
  className = '',
  ariaLabel = 'Breadcrumb',
} = Astro.props;

// Get current URL and site info
const { pathname } = Astro.url;
const siteUrl = Astro.site?.origin || Astro.url.origin;

// Generate breadcrumbs
const options: BreadcrumbOptions = {
  baseUrl: siteUrl,
  customLabels,
  homeLabel,
  maxItems,
};

const { breadcrumbs, schemaItems } = generateBreadcrumbsWithSchema(pathname, options);

// Generate JSON-LD schema
const breadcrumbSchema = generateBreadcrumbListSchema(schemaItems);

// Only render if we have breadcrumbs
const showBreadcrumbs = breadcrumbs.length > 0;
---

{showBreadcrumbs && (
  <>
    <!-- Breadcrumb Structured Data (Schema.org JSON-LD) -->
    <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

    <!-- Visual Breadcrumbs -->
    {!hideVisual && (
      <nav
        aria-label={ariaLabel}
        class={`breadcrumbs ${className}`}
      >
        <ol
          class="flex flex-wrap items-center gap-2 text-sm"
          itemscope
          itemtype="https://schema.org/BreadcrumbList"
        >
          {breadcrumbs.map((breadcrumb, index) => (
            <li
              class="flex items-center"
              itemprop="itemListElement"
              itemscope
              itemtype="https://schema.org/ListItem"
            >
              {/* Separator (not for first item) */}
              {index > 0 && (
                <svg
                  class="w-4 h-4 mx-2 text-gray-400"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                  aria-hidden="true"
                >
                  <path
                    fill-rule="evenodd"
                    d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                    clip-rule="evenodd"
                  />
                </svg>
              )}

              {/* Breadcrumb Link or Text */}
              {breadcrumb.isCurrent ? (
                <span
                  class="font-medium text-gray-700 dark:text-gray-300"
                  itemprop="name"
                  aria-current="page"
                >
                  {breadcrumb.name}
                </span>
              ) : (
                <a
                  href={breadcrumb.url}
                  class="text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 transition-colors"
                  itemprop="item"
                >
                  <span itemprop="name">{breadcrumb.name}</span>
                </a>
              )}

              {/* Hidden position for schema */}
              <meta itemprop="position" content={breadcrumb.position.toString()} />
            </li>
          ))}
        </ol>
      </nav>
    )}
  </>
)}

<style>
  /* Additional breadcrumb styling */
  .breadcrumbs {
    @apply py-4;
  }

  /* Responsive adjustments */
  @media (max-width: 640px) {
    .breadcrumbs ol {
      @apply text-xs;
    }

    .breadcrumbs svg {
      @apply w-3 h-3 mx-1;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .breadcrumbs a {
      @apply underline;
    }
  }

  /* Print styles */
  @media print {
    .breadcrumbs svg {
      @apply hidden;
    }

    .breadcrumbs li::after {
      content: ' > ';
      @apply mx-1;
    }

    .breadcrumbs li:last-child::after {
      content: '';
    }
  }
</style>
