---
/**
 * Open Graph Component
 *
 * Dedicated component for Open Graph Protocol meta tags.
 * Controls how URLs are displayed when shared on social media platforms
 * (Facebook, LinkedIn, WhatsApp, Slack, etc.).
 *
 * Usage:
 * ```astro
 * <OpenGraph
 *   title="Page Title"
 *   description="Page description for social sharing"
 *   image="/images/social-share.jpg"
 *   url="https://example.com/page"
 *   type="website"
 * />
 * ```
 *
 * Best Practices:
 * - Images: 1200x630px (1.91:1 aspect ratio)
 * - Title: 60-90 characters
 * - Description: 200 characters max
 * - Use absolute URLs for images
 *
 * Learn more: https://ogp.me
 */

interface Props {
  /**
   * Page title as it should appear when shared
   * @example "Complete Meditation Guide | Spirituality Platform"
   */
  title: string;

  /**
   * Page description for social media previews
   * @example "Learn meditation from scratch with our comprehensive guide"
   */
  description: string;

  /**
   * Absolute URL to the social share image
   * @default "/images/og-default.jpg"
   * @example "https://example.com/images/course-share.jpg"
   */
  image?: string;

  /**
   * Canonical URL of the page
   * @example "https://example.com/courses/meditation"
   */
  url: string;

  /**
   * Type of content being shared
   * @default "website"
   */
  type?: 'website' | 'article' | 'profile' | 'book' | 'music' | 'video';

  /**
   * Site name/brand
   * @default "Spirituality Platform"
   */
  siteName?: string;

  /**
   * Locale/language code
   * @default "en_US"
   */
  locale?: string;

  /**
   * Image alt text for accessibility
   */
  imageAlt?: string;

  /**
   * Image width in pixels
   * @default 1200
   */
  imageWidth?: number;

  /**
   * Image height in pixels
   * @default 630
   */
  imageHeight?: number;

  /**
   * Article published date (ISO 8601 format, for article type)
   * @example "2025-11-06T10:00:00Z"
   */
  publishedTime?: string;

  /**
   * Article modified date (ISO 8601 format, for article type)
   * @example "2025-11-06T15:30:00Z"
   */
  modifiedTime?: string;

  /**
   * Article author (for article type)
   * @example "Jane Smith"
   */
  author?: string;

  /**
   * Article section/category (for article type)
   * @example "Meditation"
   */
  section?: string;

  /**
   * Article tags (for article type)
   * @example ["mindfulness", "meditation", "wellness"]
   */
  tags?: string[];

  /**
   * Additional Open Graph tags (for extensibility)
   */
  additionalTags?: Record<string, string>;
}

const {
  title,
  description,
  image = '/images/og-default.jpg',
  url,
  type = 'website',
  siteName = 'Spirituality Platform',
  locale = 'en_US',
  imageAlt,
  imageWidth = 1200,
  imageHeight = 630,
  publishedTime,
  modifiedTime,
  author,
  section,
  tags,
  additionalTags = {},
} = Astro.props;

// Get site URL from Astro config or current URL
const siteUrl = Astro.site?.origin || Astro.url.origin;

// Ensure image URL is absolute
const absoluteImageUrl = image.startsWith('http')
  ? image
  : `${siteUrl}${image}`;

// Ensure page URL is absolute
const absoluteUrl = url.startsWith('http')
  ? url
  : `${siteUrl}${url}`;

// Use title as default alt text if not provided
const imageAltText = imageAlt || title;

// Validate image dimensions for optimal sharing
const isOptimalSize = imageWidth === 1200 && imageHeight === 630;
if (!isOptimalSize && import.meta.env.DEV) {
  console.warn(
    `OpenGraph: Image dimensions ${imageWidth}x${imageHeight} are not optimal. ` +
    `Recommended: 1200x630px (1.91:1 aspect ratio) for best display across platforms.`
  );
}

// Validate title length
if (title.length > 95 && import.meta.env.DEV) {
  console.warn(
    `OpenGraph: Title length (${title.length} chars) exceeds recommended maximum (60-90 chars). ` +
    `Long titles may be truncated on some platforms.`
  );
}

// Validate description length
if (description.length > 200 && import.meta.env.DEV) {
  console.warn(
    `OpenGraph: Description length (${description.length} chars) exceeds recommended maximum (200 chars). ` +
    `Long descriptions may be truncated on some platforms.`
  );
}
---

<!-- Open Graph / Facebook Meta Tags -->

<!-- Required Properties -->
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={absoluteImageUrl} />
<meta property="og:url" content={absoluteUrl} />
<meta property="og:type" content={type} />

<!-- Optional Properties -->
<meta property="og:site_name" content={siteName} />
<meta property="og:locale" content={locale} />

<!-- Image Metadata -->
<meta property="og:image:alt" content={imageAltText} />
<meta property="og:image:width" content={imageWidth.toString()} />
<meta property="og:image:height" content={imageHeight.toString()} />
<meta property="og:image:type" content="image/jpeg" />

<!-- Article-Specific Properties (when type="article") -->
{type === 'article' && (
  <>
    {publishedTime && (
      <meta property="article:published_time" content={publishedTime} />
    )}
    {modifiedTime && (
      <meta property="article:modified_time" content={modifiedTime} />
    )}
    {author && (
      <meta property="article:author" content={author} />
    )}
    {section && (
      <meta property="article:section" content={section} />
    )}
    {tags && tags.map((tag) => (
      <meta property="article:tag" content={tag} key={tag} />
    ))}
  </>
)}

<!-- Video-Specific Properties (when type="video") -->
{type === 'video' && additionalTags['video:url'] && (
  <>
    <meta property="video:url" content={additionalTags['video:url']} />
    {additionalTags['video:secure_url'] && (
      <meta property="video:secure_url" content={additionalTags['video:secure_url']} />
    )}
    {additionalTags['video:type'] && (
      <meta property="video:type" content={additionalTags['video:type']} />
    )}
    {additionalTags['video:width'] && (
      <meta property="video:width" content={additionalTags['video:width']} />
    )}
    {additionalTags['video:height'] && (
      <meta property="video:height" content={additionalTags['video:height']} />
    )}
  </>
)}

<!-- Profile-Specific Properties (when type="profile") -->
{type === 'profile' && (
  <>
    {additionalTags['profile:first_name'] && (
      <meta property="profile:first_name" content={additionalTags['profile:first_name']} />
    )}
    {additionalTags['profile:last_name'] && (
      <meta property="profile:last_name" content={additionalTags['profile:last_name']} />
    )}
    {additionalTags['profile:username'] && (
      <meta property="profile:username" content={additionalTags['profile:username']} />
    )}
  </>
)}

<!-- Book-Specific Properties (when type="book") -->
{type === 'book' && (
  <>
    {additionalTags['book:author'] && (
      <meta property="book:author" content={additionalTags['book:author']} />
    )}
    {additionalTags['book:isbn'] && (
      <meta property="book:isbn" content={additionalTags['book:isbn']} />
    )}
    {additionalTags['book:release_date'] && (
      <meta property="book:release_date" content={additionalTags['book:release_date']} />
    )}
  </>
)}

<!-- Additional Custom Tags -->
{Object.entries(additionalTags).map(([key, value]) => {
  // Skip tags we've already handled above
  if (key.startsWith('video:') || key.startsWith('profile:') || key.startsWith('book:')) {
    return null;
  }
  return <meta property={`og:${key}`} content={value} key={key} />;
})}

<!--
  Debug Information (Development Only)
  Remove in production or disable with environment variable
-->
{import.meta.env.DEV && (
  <script type="application/json" data-og-debug>
    {JSON.stringify({
      title,
      description,
      image: absoluteImageUrl,
      url: absoluteUrl,
      type,
      siteName,
      locale,
      imageSize: `${imageWidth}x${imageHeight}`,
      isOptimalSize,
    }, null, 2)}
  </script>
)}
