---
// API Documentation Page - Swagger UI
import BaseLayout from '@/layouts/BaseLayout.astro';
---

<BaseLayout title="API Documentation">
  <div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="bg-white border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold text-gray-900">API Documentation</h1>
            <p class="mt-2 text-sm text-gray-600">
              Interactive API documentation for the Spirituality Platform
            </p>
          </div>
          <div class="flex items-center space-x-4">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
              v1.0.0
            </span>
            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
              OpenAPI 3.0.3
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Links -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <div class="flex items-start">
          <div class="flex-shrink-0">
            <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="ml-3 flex-1">
            <h3 class="text-sm font-medium text-blue-800">Quick Start</h3>
            <div class="mt-2 text-sm text-blue-700">
              <ul class="list-disc list-inside space-y-1">
                <li>All endpoints require HTTPS in production</li>
                <li>Authentication uses session cookies (see /auth endpoints)</li>
                <li>Rate limiting is enforced per endpoint</li>
                <li>Development server: <code class="bg-blue-100 px-1 rounded">http://localhost:4321/api</code></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Swagger UI Container -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
        <div id="swagger-ui"></div>
      </div>
    </div>
  </div>

  <!-- Swagger UI CSS -->
  <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@5.10.5/swagger-ui.css" />

  <!-- Swagger UI JS -->
  <script is:inline src="https://unpkg.com/swagger-ui-dist@5.10.5/swagger-ui-bundle.js"></script>
  <script is:inline src="https://unpkg.com/swagger-ui-dist@5.10.5/swagger-ui-standalone-preset.js"></script>

  <!-- Initialize Swagger UI -->
  <script is:inline>
    window.onload = function() {
      // Initialize Swagger UI
      window.ui = SwaggerUIBundle({
        url: '/api-spec.yaml',
        dom_id: '#swagger-ui',
        deepLinking: true,
        presets: [
          SwaggerUIBundle.presets.apis,
          SwaggerUIStandalonePreset
        ],
        plugins: [
          SwaggerUIBundle.plugins.DownloadUrl
        ],
        layout: "StandaloneLayout",
        defaultModelsExpandDepth: 1,
        defaultModelExpandDepth: 1,
        docExpansion: 'list',
        filter: true,
        showRequestHeaders: true,
        tryItOutEnabled: true,
        // Custom theme configuration
        syntaxHighlight: {
          activate: true,
          theme: 'agate'
        },
        // Request interceptor for adding credentials
        requestInterceptor: (request) => {
          request.credentials = 'include'; // Include cookies for authenticated requests
          return request;
        }
      });
    };
  </script>

  <!-- Custom styles to integrate Swagger UI with Tailwind -->
  <style>
    /* Override Swagger UI styles to match our design */
    #swagger-ui {
      font-family: inherit;
    }

    #swagger-ui .swagger-ui .topbar {
      display: none; /* Hide default topbar since we have our own header */
    }

    #swagger-ui .swagger-ui .info {
      margin: 20px 0;
    }

    #swagger-ui .swagger-ui .info .title {
      font-size: 2rem;
      color: #111827;
    }

    #swagger-ui .swagger-ui .scheme-container {
      background: #f9fafb;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    #swagger-ui .swagger-ui .opblock {
      border-radius: 8px;
      margin-bottom: 15px;
      border: 1px solid #e5e7eb;
    }

    #swagger-ui .swagger-ui .opblock.opblock-get {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.05);
    }

    #swagger-ui .swagger-ui .opblock.opblock-post {
      border-color: #10b981;
      background: rgba(16, 185, 129, 0.05);
    }

    #swagger-ui .swagger-ui .opblock.opblock-put {
      border-color: #f59e0b;
      background: rgba(245, 158, 11, 0.05);
    }

    #swagger-ui .swagger-ui .opblock.opblock-delete {
      border-color: #ef4444;
      background: rgba(239, 68, 68, 0.05);
    }

    #swagger-ui .swagger-ui .btn.authorize {
      background-color: #3b82f6;
      border-color: #3b82f6;
    }

    #swagger-ui .swagger-ui .btn.execute {
      background-color: #3b82f6;
      border-color: #3b82f6;
    }

    #swagger-ui .swagger-ui .response-col_status {
      font-weight: 600;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      #swagger-ui .swagger-ui .info .title {
        font-size: 1.5rem;
      }
    }
  </style>
</BaseLayout>
